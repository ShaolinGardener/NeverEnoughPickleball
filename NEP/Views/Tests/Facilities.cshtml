@model IEnumerable<NEP.Models.Facility>

@{
    Layout = "~/Views/Shared/_Corporate.cshtml";

    ViewData["Title"] = "Facilities";
    var lat = 0.00;
    var lon = 0.00;
    if (ViewBag.Latitude != null)
    {
        lat = ViewBag.Latitude;
        lon = ViewBag.Longitude;
    }

}
<script src="~/js/jquery.min.js"></script>
<script>
    // default to cady way
    window.userlatitude = 28.5937504;
    window.userlongitude = -81.317328;
    var useAddressLatLong = false;
    @if (ViewBag.Latitude != null)
    {
        @Html.Raw("useAddressLatLong = true;")

    }
                if (useAddressLatLong) {
        window.userlatitude = @lat;
        window.userlongitude = @lon;
    }
    else {
        //debugger;
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // Success: User's location is available in the 'position' object
                    window.userlatitude = position.coords.latitude;
                    window.userlongitude = position.coords.longitude;
                    if (typeof MyMap !== 'undefined') {
                        MyMap();
                    }

                    // You can now use the 'latitude' and 'longitude' values in your code
                    // For example, display the user's location on the map
                    // or use it to make location-based requests to a server, etc.
                },
                (error) => {
                    // Error handling if the user denies the permission or if there is an error
                    console.error("Error getting user's location:", error.message);
                }
            );
        } else {
            // Geolocation is not supported in this browser
            // Handle the lack of support here (show a message, etc.)
        }
    }
</script>
<style>
    body:not(.woocommerce-page) table tr:hover td, body:not(.woocommerce-page) table tr:hover td a {
        color: black;
    }
</style>

<body style="margin-left:50px">
    <div id="Header_creative">
        <a href="#" class="creative-menu-toggle"><i class="icon-menu-fine"></i></a>
        <div class="creative-social">
        </div>
        <div class="creative-wrapper">
            <div class="header_placeholder"></div>
            <div id="Top_bar">
                <div class="one clearfix">
                    <div class="top_bar_left">
                        <div class="logo">
                            <a id="logo" href="#" title="Never Enough Pickleball" data-height="60" data-padding="50"><img class="logo-main scale-with-grid" src="/gsm/content/gsmservice/images/gsmservice.png" data-retina="/gsm/content/gsmservice/images/retina-gsmservice.png" data-height="57"><img class="logo-sticky scale-with-grid" src="/gsm/content/gsmservice/images/gsmservice.png" data-retina="/gsm/content/gsmservice/images/retina-gsmservice.png" data-height="57"><img class="logo-mobile scale-with-grid" src="/gsm/content/gsmservice/images/gsmservice.png" data-retina="/gsm/content/gsmservice/images/retina-gsmservice.png" data-height="57"><img class="logo-mobile-sticky scale-with-grid" src="/gsm/content/gsmservice/images/gsmservice.png" data-retina="/gsm/content/gsmservice/images/retina-gsmservice.png" data-height="57"></a>
                        </div>
                        <div class="menu_wrapper">
                            <nav id="menu">
                                <ul id="menu-main-menu" class="menu menu-main">
                                    <li>
                                        <a href="/#Header_wrapper"><span>Home</span></a>
                                    </li>

                                </ul>
                            </nav>
                            <a class="responsive-menu-toggle" href="#"><i class="icon-menu-fine"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="section mcb-section" id="ouroffer" style="padding-top:50px; padding-bottom:0px; background-color:#fff">
        <div class="section_wrapper mcb-section-inner">
            <div class="wrap mcb-wrap one valign-top clearfix">
                <div class="mcb-wrap-inner">
                    <div class="column mcb-column one-second column_column" style="margin-top:50px">
                        <h1 style="font-family: Header2Font; color: #ff6801">Find Pickleball Courts<br />Near You</h1>
                        <h4 style="color:#2a2a2a">By allowing us to use your location or entering an address</strong></h4>
                    </div>
                    <div class="column mcb-column one-second column_column" style="text-align:right">
                        <img src="~/gsm/images/corporateLogo.png" />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="section mcb-section" id="ouroffer" style="padding-top:30px; padding-bottom:0px; background-color:#fff">
        <div class="section_wrapper mcb-section-inner">
            <div class="wrap mcb-wrap one valign-top clearfix">
                <h3 style="color: #ff6801">Pickleball Court Search</h3>
                <div class="mcb-wrap-inner">
                    <div class="column mcb-column one-second column_column">
                        <form action="Facilities" method="post" onsubmit="return CheckFormAddress();">
                            <p>Enter Address:</p> <input type="text" id="address" name="address" value="@ViewBag.Address" />
                            <p>Radius in Miles:</p>
                            <select id="radius" name="radius">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                            <input type="submit" value="Get Facilities" />
                            <input type="hidden" name="latitude" id="latitude" />
                            <input type="hidden" name="longitude" id="longitude" />
                        </form>
                    </div>
                    <div class="column mcb-column one-second column_column" style="text-align:right">
                        <div id="googleMap" style="width:100%;height:400px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @*<div class="column mcb-column one column_column">
    <div class="column_attr clearfix" style="text-align:left;background-color:#fff; padding:25px 15%; border-radius: 6px;">
    <h3 style="color: #ff6801">Pickleball Court Search</h3>

    <div class="wrap mcb-wrap one valign-top clearfix">
    <div class="mcb-wrap-inner">
    <div class="column mcb-column one-second column_column">
    <form action="Facilities" method="post" onsubmit="return CheckFormAddress();">
    <p>Enter Address:</p> <input type="text" id="address" name="address" value="@ViewBag.Address" />
    <p>Radius in Miles:</p>
    <select id="radius" name="radius">
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="20">20</option>
    <option value="50">50</option>
    </select>
    <input type="submit" value="Get Facilities" />
    <input type="hidden" name="latitude" id="latitude" />
    <input type="hidden" name="longitude" id="longitude" />
    </form>
    </div>
    <div class="column mcb-column one-second column_column" style="text-align:right">
    <div id="googleMap" style="width:100%;height:400px;"></div>
    </div>
    </div>
    </div>
    </div>
    </div>*@
    @* <form action="Facilities" method="post" onsubmit="return CheckFormAddress();">
    <p>Enter Address:</p> <input type="text" id="address" name="address" value="@ViewBag.Address" />
    <p>Radius in Miles:</p>
    <select id="radius" name="radius">
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="20">20</option>
    <option value="50">50</option>
    </select>
    <input type="submit" value="Get Facilities" />
    <input type="hidden" name="latitude" id="latitude" />
    <input type="hidden" name="longitude" id="longitude" />
    </form>

    <div id="googleMap" style="width:100%;height:400px;"></div>*@

    <script>
        function myMap() {
            //debugger;
            var mapProp = {
                center: new google.maps.LatLng(window.userlatitude, window.userlongitude),
                zoom: 10,
            };
            var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

            map.addListener("center_changed", function () {
                updateSearchResults(map.getCenter()); // Pass the new center to update search results
            });

        @if (Model != null)
        {
            @Html.Raw("locations = [")


            @foreach (var item in Model)
            {
                @Html.Raw("{ lat: " + item.Address.Latitude + ", lng: " + item.Address.Longitude + ", title: '" + item.Name + "',description: '" + item.Address.Address1 + "'},")
            }

            @Html.Raw("];")
            @Html.Raw("locations.forEach(function (location) {" +
                "var marker = new google.maps.Marker({ " +
                "position: location," +
                "map: map,title:location.title" +
                "}); " +
                "var infoWindow = new google.maps.InfoWindow({" +
                "content: \"<h3>\" + location.title + \"</h3><p>\" + location.description + \"</p>" +
                "<a href='https://www.google.com/maps/dir/\" + window.userlatitude + \",\" + window.userlongitude + \"/\" + location.lat + \",\" + location.lng + \"' target='_blank'>" +
                "Get Directions</a>\""+
                "});" +
                "marker.addListener('click', function () {" +
                "infoWindow.open(map, marker);" +
                "});" +
                "});")
        }
                                }
    </script>

    <br />

    @if (Model != null)
    {
        <div class="section mcb-section" id="ouroffer" style="padding-top:50px; padding-bottom:0px; background-color:#fff">
            <div class="section_wrapper mcb-section-inner">
                <div class="wrap mcb-wrap one valign-top clearfix">
                    <div class="mcb-wrap-inner">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>
                                        @Html.DisplayNameFor(model => model.Name)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.Description)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.Address)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.Phone)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.Url)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.ContactName)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.ContactEmail)
                                    </th>

                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Name)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Description)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Address.Address1)
                                            @if (item.Address.Address2 != null)
                                            {
                                                <br>
                                                @Html.DisplayFor(modelItem => item.Address.Address2)
                                            }
                                            <br>
                                            @Html.DisplayFor(modelItem => item.Address.City)
                                            <br>
                                            @Html.DisplayFor(modelItem => item.Address.ZipCode)

                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Phone)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Url)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.ContactName)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.ContactEmail)
                                        </td>

                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    }
    <script>
        $(function () {
            $("#radius").val(@ViewBag.Radius);
            $("#latitude").val(latitude);
            $("#longitude").val(longitude);
        });

        function CheckFormAddress() {
            if (($("#address").val().trim().length == 0) && ($("#latitude").val().length == 0)) {
                alert("Please allow location or enter an address");
                return false;
            }
        }

        function updateSearchResults(newCenter) {
            // Perform your search based on the new center
            // This might involve making an API request, querying a database, or other actions
            // Update your search results on the map accordingly
            searchService.performSearch(newCenter);
        }
    </script>
    <script defer src="https://maps.googleapis.com/maps/api/js?key=@ViewBag.APIKey&callback=myMap"></script>
</body>
